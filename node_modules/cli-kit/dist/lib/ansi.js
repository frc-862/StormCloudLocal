"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.esc = exports.erase = exports.custom = exports.cursor = exports.clear = exports.bel = void 0;
exports.link = link;
exports.scroll = void 0;
exports.split = split;
exports.strip = strip;
exports.toLowerCase = toLowerCase;
exports.toUpperCase = toUpperCase;
exports.trim = trim;
exports.trimEnd = trimEnd;
exports.trimStart = trimStart;

var _util = require("./util");

const bel = '\x07';
exports.bel = bel;
const clear = '\x1bc';
exports.clear = clear;
const cursor = {
  show: '\x1b[?25h',
  hide: '\x1b[?25l',
  save: '\x1b7',
  restore: '\x1b8',
  get: '\x1b[6n',
  home: '\x1b[H',
  left: '\x1b[G',

  down(n = 1) {
    return n ? `\x1b[${n}B` : '';
  },

  up(n = 1) {
    return n ? `\x1b[${n}A` : '';
  },

  backward(n = 1) {
    return n ? `\x1b[${n}D` : '';
  },

  forward(n = 1) {
    return n ? `\x1b[${n}C` : '';
  },

  move(dx, dy) {
    let s = dx ? `\x1b[${dx > 0 ? `${dx}C` : `${-dx}D`}` : '';

    if (dy) {
      s += `\x1b[${dy > 0 ? `${dy}B` : `${-dy}A`}`;
    }

    return s;
  },

  to(x, y) {
    return y ? `\x1b[${y + 1};${x + 1}H` : `\x1b[${x + 1}G`;
  },

  position: /^\x1b\[(\d+);(\d+)R$/,

  next(n = 1) {
    return !n ? '' : (n < 0 ? '\x1b[F' : '\x1b[E').repeat(Math.abs(n));
  },

  prev(n = 1) {
    return !n ? '' : (n > 0 ? '\x1b[F' : '\x1b[E').repeat(Math.abs(n));
  }

};
exports.cursor = cursor;
const custom = {
  echo(enabled) {
    return `\x1b]666;Echo=${enabled ? 'on' : 'off'}\x07`;
  },

  exec(command) {
    return `\x1b]666;Exec=${(0, _util.encode)(command)}\x07`;
  },

  exit(code) {
    return `\x1b]666;Exit=${code}\x07`;
  },

  keypress(key) {
    return `\x1b]666;Keypress=${(0, _util.encode)(key)}\x07`;
  }

};
exports.custom = custom;
custom.echo.re = /^\x1b\]666;Echo=(\w+)\x07$/;
custom.exec.re = /^\x1b\]666;Exec=(.+)\x07$/;
custom.exit.re = /^\x1b\]666;Exit=(\d+)\x07$/;
custom.keypress.re = /^\x1b\]666;Keypress=(.+)\x07$/;
const erase = {
  down: '\x1b[J',
  line: '\x1b[2K',

  lines(count = 0) {
    let s = '';

    while (count > 0) {
      s += this.line + (--count ? cursor.up() : '');
    }

    return s ? `${s}${cursor.left}` : '';
  },

  screen: '\x1b[2J',
  toEnd: '\x1b[K',
  toStart: '\x1b[1K',
  up: '\x1b[1J'
};
exports.erase = erase;
const esc = '\x1b[';
exports.esc = esc;
const scroll = {
  down: '\x1b[T',
  up: '\x1b[S'
};
/**
 * Creates a hyperlink for rendering in a terminal.
 *
 * @param {String} [text] - The clickable text to display.
 * @param {String} url - The link URL.
 * @returns {String}
 */

exports.scroll = scroll;

function link(text, url) {
  return `\x1b]8;;${url || text}\x07${text}\x1b]8;;\x07`;
}
/**
 * Splits a string into an array where even number indices are plain strings and odd number
 * indices are ANSI escape sequences.
 *
 * @param {String} str - The string to split.
 * @returns {Array.<String>}
 */


function split(str) {
  if (typeof str !== 'string') {
    return str;
  }

  const results = [];
  const re = /\x07|\x1b(?:[a-z\d]|\[\?25[hl]|\[[A-Za-z]|\[\d+[A-Za-z]|\[\d+;\d+H|\]\d+[^\x07]+\x07)/;
  let m;

  while (m = re.exec(str)) {
    results.push(m.index ? str.substring(0, m.index) : '');
    results.push(str.substr(m.index, m[0].length));
    str = str.substring(m.index + m[0].length);
  }

  if (str) {
    results.push(str);
  }

  return results;
}

const stripRegExp = /\x1b\[(;?\d+)+m/g;
/**
 * Removes all ansi control sequences from the specified string.
 *
 * @param {String} str - The string to strip.
 * @returns {String}
 */

function strip(str = '') {
  return String(str).replace(stripRegExp, '');
}
/**
 * Converts a string to lower case without tampering with any ANSI escape sequences.
 *
 * @param {String} str - The string to lower case.
 * @returns {String}
 */


function toLowerCase(str) {
  return split(str).map((s, i) => i % 2 === 0 ? s.toLowerCase() : s).join('');
}
/**
 * Converts a string to upper case without tampering with any ANSI escape sequences.
 *
 * @param {String} str - The string to upper case.
 * @returns {String}
 */


function toUpperCase(str) {
  return split(str).map((s, i) => i % 2 === 0 ? s.toUpperCase() : s).join('');
}

function trim(str) {
  return trimStart(trimEnd(str));
}

function trimStart(str) {
  if (str !== undefined && str !== null) {
    str = String(str).replace(/^\s*(\x07|\x1b(?:[a-z\d]|\[\?25[hl]|\[[A-Za-z]|\[\d+[A-Za-z]|\[\d+;\d+H|\]\d+[^\x07]+\x07))?\s*/, '$1');
  }

  return str;
}

function trimEnd(str) {
  if (str !== undefined && str !== null) {
    // '\u001b[' + b + 'm'
    str = String(str).replace(/\s*(\x07|\x1b(?:[a-z\d]|\[\?25[hl]|\[[A-Za-z]|\[\d+[A-Za-z]|\[\d+;\d+H|\]\d+[^\x07]+\x07))?\s*$/, '$1');
  }

  return str;
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbnNpLmpzIl0sIm5hbWVzIjpbImJlbCIsImNsZWFyIiwiY3Vyc29yIiwic2hvdyIsImhpZGUiLCJzYXZlIiwicmVzdG9yZSIsImdldCIsImhvbWUiLCJsZWZ0IiwiZG93biIsIm4iLCJ1cCIsImJhY2t3YXJkIiwiZm9yd2FyZCIsIm1vdmUiLCJkeCIsImR5IiwicyIsInRvIiwieCIsInkiLCJwb3NpdGlvbiIsIm5leHQiLCJyZXBlYXQiLCJNYXRoIiwiYWJzIiwicHJldiIsImN1c3RvbSIsImVjaG8iLCJlbmFibGVkIiwiZXhlYyIsImNvbW1hbmQiLCJleGl0IiwiY29kZSIsImtleXByZXNzIiwia2V5IiwicmUiLCJlcmFzZSIsImxpbmUiLCJsaW5lcyIsImNvdW50Iiwic2NyZWVuIiwidG9FbmQiLCJ0b1N0YXJ0IiwiZXNjIiwic2Nyb2xsIiwibGluayIsInRleHQiLCJ1cmwiLCJzcGxpdCIsInN0ciIsInJlc3VsdHMiLCJtIiwicHVzaCIsImluZGV4Iiwic3Vic3RyaW5nIiwic3Vic3RyIiwibGVuZ3RoIiwic3RyaXBSZWdFeHAiLCJzdHJpcCIsIlN0cmluZyIsInJlcGxhY2UiLCJ0b0xvd2VyQ2FzZSIsIm1hcCIsImkiLCJqb2luIiwidG9VcHBlckNhc2UiLCJ0cmltIiwidHJpbVN0YXJ0IiwidHJpbUVuZCIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVPLE1BQU1BLEdBQUcsR0FBRyxNQUFaOztBQUVBLE1BQU1DLEtBQUssR0FBRyxPQUFkOztBQUVBLE1BQU1DLE1BQU0sR0FBRztBQUNyQkMsRUFBQUEsSUFBSSxFQUFLLFdBRFk7QUFFckJDLEVBQUFBLElBQUksRUFBSyxXQUZZO0FBR3JCQyxFQUFBQSxJQUFJLEVBQUssT0FIWTtBQUlyQkMsRUFBQUEsT0FBTyxFQUFFLE9BSlk7QUFLckJDLEVBQUFBLEdBQUcsRUFBTSxTQUxZO0FBTXJCQyxFQUFBQSxJQUFJLEVBQUssUUFOWTtBQU9yQkMsRUFB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VyxPQUFaLENBQW9CLGlHQUFwQixFQUF1SCxJQUF2SCxDQUFOO0FBQ0E7O0FBQ0QsU0FBT1gsR0FBUDtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZW5jb2RlIH0gZnJvbSAnLi91dGlsJztcblxuZXhwb3J0IGNvbnN0IGJlbCA9ICdcXHgwNyc7XG5cbmV4cG9ydCBjb25zdCBjbGVhciA9ICdcXHgxYmMnO1xuXG5leHBvcnQgY29uc3QgY3Vyc29yID0ge1xuXHRzaG93OiAgICAnXFx4MWJbPzI1aCcsXG5cdGhpZGU6ICAgICdcXHgxYls/MjVsJyxcblx0c2F2ZTogICAgJ1xceDFiNycsXG5cdHJlc3RvcmU6ICdcXHgxYjgnLFxuXHRnZXQ6ICAgICAnXFx4MWJbNm4nLFxuXHRob21lOiAgICAnXFx4MWJbSCcsXG5cdGxlZnQ6ICAgICdcXHgxYltHJyxcblxuXHRkb3duKG4gPSAxKSAgeyByZXR1cm4gbiA/IGBcXHgxYlske259QmAgOiAnJzsgfSxcblx0dXAobiA9IDEpICAgIHsgcmV0dXJuIG4gPyBgXFx4MWJbJHtufUFgIDogJyc7IH0sXG5cblx0YmFja3dhcmQobiA9IDEpICB7IHJldHVybiBuID8gYFxceDFiWyR7bn1EYCA6ICcnOyB9LFxuXHRmb3J3YXJkKG4gPSAxKSB7IHJldHVybiBuID8gYFxceDFiWyR7bn1DYCA6ICcnOyB9LFxuXG5cdG1vdmUoZHgsIGR5KSB7XG5cdFx0bGV0IHMgPSBkeCA/IGBcXHgxYlske2R4ID4gMCA/IGAke2R4fUNgIDogYCR7LWR4fURgfWAgOiAnJztcblx0XHRpZiAoZHkpIHtcblx0XHRcdHMgKz0gYFxceDFiWyR7ZHkgPiAwID8gYCR7ZHl9QmAgOiBgJHstZHl9QWB9YDtcblx0XHR9XG5cdFx0cmV0dXJuIHM7XG5cdH0sXG5cdHRvKHgsIHkpIHtcblx0XHRyZXR1cm4geSA/IGBcXHgxYlske3kgKyAxfTske3ggKyAxfUhgIDogYFxceDFiWyR7eCArIDF9R2A7XG5cdH0sXG5cblx0cG9zaXRpb246IC9eXFx4MWJcXFsoXFxkKyk7KFxcZCspUiQvLFxuXG5cdG5leHQobiA9IDEpIHsgcmV0dXJuICFuID8gJycgOiAobiA8IDAgPyAnXFx4MWJbRicgOiAnXFx4MWJbRScpLnJlcGVhdChNYXRoLmFicyhuKSk7IH0sXG5cdHByZXYobiA9IDEpIHsgcmV0dXJuICFuID8gJycgOiAobiA+IDAgPyAnXFx4MWJbRicgOiAnXFx4MWJbRScpLnJlcGVhdChNYXRoLmFicyhuKSk7IH1cbn07XG5cbmV4cG9ydCBjb25zdCBjdXN0b20gPSB7XG5cdGVjaG8oZW5hYmxlZCkge1xuXHRcdHJldHVybiBgXFx4MWJdNjY2O0VjaG89JHtlbmFibGVkID8gJ29uJyA6ICdvZmYnfVxceDA3YDtcblx0fSxcblx0ZXhlYyhjb21tYW5kKSB7XG5cdFx0cmV0dXJuIGBcXHgxYl02NjY7RXhlYz0ke2VuY29kZShjb21tYW5kKX1cXHgwN2A7XG5cdH0sXG5cdGV4aXQoY29kZSkge1xuXHRcdHJldHVybiBgXFx4MWJdNjY2O0V4aXQ9JHtjb2RlfVxceDA3YDtcblx0fSxcblx0a2V5cHJlc3Moa2V5KSB7XG5cdFx0cmV0dXJuIGBcXHgxYl02NjY7S2V5cHJlc3M9JHtlbmNvZGUoa2V5KX1cXHgwN2A7XG5cdH1cbn07XG5cbmN1c3RvbS5lY2hvLnJlID0gL15cXHgxYlxcXTY2NjtFY2hvPShcXHcrKVxceDA3JC87XG5jdXN0b20uZXhlYy5yZSA9IC9eXFx4MWJcXF02NjY7RXhlYz0oLispXFx4MDckLztcbmN1c3RvbS5leGl0LnJlID0gL15cXHgxYlxcXTY2NjtFeGl0PShcXGQrKVxceDA3JC87XG5jdXN0b20ua2V5cHJlc3MucmUgPSAvXlxceDFiXFxdNjY2O0tleXByZXNzPSguKylcXHgwNyQvO1xuXG5leHBvcnQgY29uc3QgZXJhc2UgPSB7XG5cdGRvd246ICAgICdcXHgxYltKJyxcblx0bGluZTogICAgJ1xceDFiWzJLJyxcblx0bGluZXMoY291bnQgPSAwKSB7XG5cdFx0bGV0IHMgPSAnJztcblx0XHR3aGlsZSAoY291bnQgPiAwKSB7XG5cdFx0XHRzICs9IHRoaXMubGluZSArICgtLWNvdW50ID8gY3Vyc29yLnVwKCkgOiAnJyk7XG5cdFx0fVxuXHRcdHJldHVybiBzID8gYCR7c30ke2N1cnNvci5sZWZ0fWAgOiAnJztcblx0fSxcblx0c2NyZWVuOiAgJ1xceDFiWzJKJyxcblx0dG9FbmQ6ICAgJ1xceDFiW0snLFxuXHR0b1N0YXJ0OiAnXFx4MWJbMUsnLFxuXHR1cDogICAgICAnXFx4MWJbMUonXG59O1xuXG5leHBvcnQgY29uc3QgZXNjID0gJ1xceDFiWyc7XG5cbmV4cG9ydCBjb25zdCBzY3JvbGwgPSB7XG5cdGRvd246ICdcXHgxYltUJyxcblx0dXA6ICAgJ1xceDFiW1MnXG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBoeXBlcmxpbmsgZm9yIHJlbmRlcmluZyBpbiBhIHRlcm1pbmFsLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBbdGV4dF0gLSBUaGUgY2xpY2thYmxlIHRleHQgdG8gZGlzcGxheS5cbiAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgLSBUaGUgbGluayBVUkwuXG4gKiBAcmV0dXJucyB7U3RyaW5nfVxuICovXG5leHBvcnQgZnVuY3Rpb24gbGluayh0ZXh0LCB1cmwpIHtcblx0cmV0dXJuIGBcXHgxYl04Ozske3VybCB8fCB0ZXh0fVxceDA3JHt0ZXh0fVxceDFiXTg7O1xceDA3YDtcbn1cblxuLyoqXG4gKiBTcGxpdHMgYSBzdHJpbmcgaW50byBhbiBhcnJheSB3aGVyZSBldmVuIG51bWJlciBpbmRpY2VzIGFyZSBwbGFpbiBzdHJpbmdzIGFuZCBvZGQgbnVtYmVyXG4gKiBpbmRpY2VzIGFyZSBBTlNJIGVzY2FwZSBzZXF1ZW5jZXMuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IHN0ciAtIFRoZSBzdHJpbmcgdG8gc3BsaXQuXG4gKiBAcmV0dXJucyB7QXJyYXkuPFN0cmluZz59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzcGxpdChzdHIpIHtcblx0aWYgKHR5cGVvZiBzdHIgIT09ICdzdHJpbmcnKSB7XG5cdFx0cmV0dXJuIHN0cjtcblx0fVxuXG5cdGNvbnN0IHJlc3VsdHMgPSBbXTtcblx0Y29uc3QgcmUgPSAvXFx4MDd8XFx4MWIoPzpbYS16XFxkXXxcXFtcXD8yNVtobF18XFxbW0EtWmEtel18XFxbXFxkK1tBLVphLXpdfFxcW1xcZCs7XFxkK0h8XFxdXFxkK1teXFx4MDddK1xceDA3KS87XG5cdGxldCBtO1xuXG5cdHdoaWxlIChtID0gcmUuZXhlYyhzdHIpKSB7XG5cdFx0cmVzdWx0cy5wdXNoKG0uaW5kZXggPyBzdHIuc3Vic3RyaW5nKDAsIG0uaW5kZXgpIDogJycpO1xuXHRcdHJlc3VsdHMucHVzaChzdHIuc3Vic3RyKG0uaW5kZXgsIG1bMF0ubGVuZ3RoKSk7XG5cdFx0c3RyID0gc3RyLnN1YnN0cmluZyhtLmluZGV4ICsgbVswXS5sZW5ndGgpO1xuXHR9XG5cblx0aWYgKHN0cikge1xuXHRcdHJlc3VsdHMucHVzaChzdHIpO1xuXHR9XG5cblx0cmV0dXJuIHJlc3VsdHM7XG59XG5cbmNvbnN0IHN0cmlwUmVnRXhwID0gL1xceDFiXFxbKDs/XFxkKykrbS9nO1xuXG4vKipcbiAqIFJlbW92ZXMgYWxsIGFuc2kgY29udHJvbCBzZXF1ZW5jZXMgZnJvbSB0aGUgc3BlY2lmaWVkIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gc3RyIC0gVGhlIHN0cmluZyB0byBzdHJpcC5cbiAqIEByZXR1cm5zIHtTdHJpbmd9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdHJpcChzdHIgPSAnJykge1xuXHRyZXR1cm4gU3RyaW5nKHN0cikucmVwbGFjZShzdHJpcFJlZ0V4cCwgJycpO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGEgc3RyaW5nIHRvIGxvd2VyIGNhc2Ugd2l0aG91dCB0YW1wZXJpbmcgd2l0aCBhbnkgQU5TSSBlc2NhcGUgc2VxdWVuY2VzLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBzdHIgLSBUaGUgc3RyaW5nIHRvIGxvd2VyIGNhc2UuXG4gKiBAcmV0dXJucyB7U3RyaW5nfVxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9Mb3dlckNhc2Uoc3RyKSB7XG5cdHJldHVybiBzcGxpdChzdHIpLm1hcCgocywgaSkgPT4gaSAlIDIgPT09IDAgPyBzLnRvTG93ZXJDYXNlKCkgOiBzKS5qb2luKCcnKTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIHN0cmluZyB0byB1cHBlciBjYXNlIHdpdGhvdXQgdGFtcGVyaW5nIHdpdGggYW55IEFOU0kgZXNjYXBlIHNlcXVlbmNlcy5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gc3RyIC0gVGhlIHN0cmluZyB0byB1cHBlciBjYXNlLlxuICogQHJldHVybnMge1N0cmluZ31cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvVXBwZXJDYXNlKHN0cikge1xuXHRyZXR1cm4gc3BsaXQoc3RyKS5tYXAoKHMsIGkpID0+IGkgJSAyID09PSAwID8gcy50b1VwcGVyQ2FzZSgpIDogcykuam9pbignJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmltKHN0cikge1xuXHRyZXR1cm4gdHJpbVN0YXJ0KHRyaW1FbmQoc3RyKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmltU3RhcnQoc3RyKSB7XG5cdGlmIChzdHIgIT09IHVuZGVmaW5lZCAmJiBzdHIgIT09IG51bGwpIHtcblx0XHRzdHIgPSBTdHJpbmcoc3RyKS5yZXBsYWNlKC9eXFxzKihcXHgwN3xcXHgxYig/OlthLXpcXGRdfFxcW1xcPzI1W2hsXXxcXFtbQS1aYS16XXxcXFtcXGQrW0EtWmEtel18XFxbXFxkKztcXGQrSHxcXF1cXGQrW15cXHgwN10rXFx4MDcpKT9cXHMqLywgJyQxJyk7XG5cdH1cblx0cmV0dXJuIHN0cjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRyaW1FbmQoc3RyKSB7XG5cdGlmIChzdHIgIT09IHVuZGVmaW5lZCAmJiBzdHIgIT09IG51bGwpIHtcblx0XHQvLyAnXFx1MDAxYlsnICsgYiArICdtJ1xuXHRcdHN0ciA9IFN0cmluZyhzdHIpLnJlcGxhY2UoL1xccyooXFx4MDd8XFx4MWIoPzpbYS16XFxkXXxcXFtcXD8yNVtobF18XFxbW0EtWmEtel18XFxbXFxkK1tBLVphLXpdfFxcW1xcZCs7XFxkK0h8XFxdXFxkK1teXFx4MDddK1xceDA3KSk/XFxzKiQvLCAnJDEnKTtcblx0fVxuXHRyZXR1cm4gc3RyO1xufVxuIl0sImZpbGUiOiJsaWIvYW5zaS5qcyJ9
